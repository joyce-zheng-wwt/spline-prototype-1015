"use strict";exports.id=117,exports.ids=[117],exports.modules={3117:(a,b,c)=>{c.r(b),c.d(b,{CompressedGaussianSplats:()=>R,GSplineBuffer:()=>b5,GaussianPLYData:()=>Q});var d=Object.create,e=Object.defineProperty,f=Object.getOwnPropertyDescriptor,g=Object.getOwnPropertyNames,h=Object.getPrototypeOf,i=Object.prototype.hasOwnProperty,j=(a,b)=>()=>(b||a((b={exports:{}}).exports,b),b.exports),k=(a,b)=>{for(var c in b)e(a,c,{get:b[c],enumerable:!0})},l=(a,b,c)=>(c=null!=a?d(h(a)):{},((a,b,c,d)=>{if(b&&"object"==typeof b||"function"==typeof b)for(let h of g(b))i.call(a,h)||h===c||e(a,h,{get:()=>b[h],enumerable:!(d=f(b,h))||d.enumerable});return a})(!b&&a&&a.__esModule?c:e(c,"default",{value:a,enumerable:!0}),a)),m=(a,b,c)=>(((a,b,c)=>b in a?e(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c)(a,"symbol"!=typeof b?b+"":b,c),c),n=j((a,b)=>{b.exports=function(a){for(var b=Array(a),c=0;c<a;++c)b[c]=c;return b}}),o=j((a,b)=>{function c(a){return!!a.constructor&&"function"==typeof a.constructor.isBuffer&&a.constructor.isBuffer(a)}b.exports=function(a){var b;return null!=a&&(c(a)||"function"==typeof(b=a).readFloatLE&&"function"==typeof b.slice&&c(b.slice(0,0))||!!a._isBuffer)}}),p=j((a,b)=>{var c=n(),d=o(),e="u">typeof Float64Array;function f(a,b){return a[0]-b[0]}function g(){var a,b=this.stride,c=Array(b.length);for(a=0;a<c.length;++a)c[a]=[Math.abs(b[a]),a];c.sort(f);var d=Array(c.length);for(a=0;a<d.length;++a)d[a]=c[a][1];return d}var h={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};b.exports=function(a,b,f,i){if(void 0===a){var j=h.array[0];return j([])}"number"==typeof a&&(a=[a]),void 0===b&&(b=[a.length]);var k=b.length;if(void 0===f){f=Array(k);for(var l=k-1,m=1;l>=0;--l)f[l]=m,m*=b[l]}if(void 0===i){i=0;for(var l=0;l<k;++l)f[l]<0&&(i-=(b[l]-1)*f[l])}for(var n=function(a){if(d(a))return"buffer";if(e)switch(Object.prototype.toString.call(a)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(a)?"array":"generic"}(a),o=h[n];o.length<=k+1;)o.push(function(a,b){var d="View"+b+"d"+a;b<0&&(d="View_Nil"+a);var e="generic"===a;if(-1===b){var f="function "+d+"(a){this.data=a;};var proto="+d+".prototype;proto.dtype='"+a+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+d+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+d+"(a){return new "+d+"(a);}",i=Function(f);return i()}if(0===b){var f="function "+d+"(a,d) {this.data = a;this.offset = d};var proto="+d+".prototype;proto.dtype='"+a+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+d+"_copy() {return new "+d+"(this.data,this.offset)};proto.pick=function "+d+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+d+"_get(){return "+(e?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+d+"_set(v){return "+(e?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+d+"(a,b,c,d){return new "+d+"(a,d)}",i=Function("TrivialArray",f);return i(h[a][0])}var f=["'use strict'"],j=c(b),k=j.map(function(a){return"i"+a}),l="this.offset+"+j.map(function(a){return"this.stride["+a+"]*i"+a}).join("+"),m=j.map(function(a){return"b"+a}).join(","),n=j.map(function(a){return"c"+a}).join(",");f.push("function "+d+"(a,"+m+","+n+",d){this.data=a","this.shape=["+m+"]","this.stride=["+n+"]","this.offset=d|0}","var proto="+d+".prototype","proto.dtype='"+a+"'","proto.dimension="+b),f.push("Object.defineProperty(proto,'size',{get:function "+d+"_size(){return "+j.map(function(a){return"this.shape["+a+"]"}).join("*"),"}})"),1===b?f.push("proto.order=[0]"):(f.push("Object.defineProperty(proto,'order',{get:"),b<4?(f.push("function "+d+"_order(){"),2===b?f.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&f.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):f.push("ORDER})")),f.push("proto.set=function "+d+"_set("+k.join(",")+",v){"),e?f.push("return this.data.set("+l+",v)}"):f.push("return this.data["+l+"]=v}"),f.push("proto.get=function "+d+"_get("+k.join(",")+"){"),e?f.push("return this.data.get("+l+")}"):f.push("return this.data["+l+"]}"),f.push("proto.index=function "+d+"_index(",k.join(),"){return "+l+"}"),f.push("proto.hi=function "+d+"_hi("+k.join(",")+"){return new "+d+"(this.data,"+j.map(function(a){return"(typeof i"+a+"!=='number'||i"+a+"<0)?this.shape["+a+"]:i"+a+"|0"}).join(",")+","+j.map(function(a){return"this.stride["+a+"]"}).join(",")+",this.offset)}");var o=j.map(function(a){return"a"+a+"=this.shape["+a+"]"}),p=j.map(function(a){return"c"+a+"=this.stride["+a+"]"});f.push("proto.lo=function "+d+"_lo("+k.join(",")+"){var b=this.offset,d=0,"+o.join(",")+","+p.join(","));for(var q=0;q<b;++q)f.push("if(typeof i"+q+"==='number'&&i"+q+">=0){d=i"+q+"|0;b+=c"+q+"*d;a"+q+"-=d}");f.push("return new "+d+"(this.data,"+j.map(function(a){return"a"+a}).join(",")+","+j.map(function(a){return"c"+a}).join(",")+",b)}"),f.push("proto.step=function "+d+"_step("+k.join(",")+"){var "+j.map(function(a){return"a"+a+"=this.shape["+a+"]"}).join(",")+","+j.map(function(a){return"b"+a+"=this.stride["+a+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(var q=0;q<b;++q)f.push("if(typeof i"+q+"==='number'){d=i"+q+"|0;if(d<0){c+=b"+q+"*(a"+q+"-1);a"+q+"=ceil(-a"+q+"/d)}else{a"+q+"=ceil(a"+q+"/d)}b"+q+"*=d}");f.push("return new "+d+"(this.data,"+j.map(function(a){return"a"+a}).join(",")+","+j.map(function(a){return"b"+a}).join(",")+",c)}");for(var r=Array(b),s=Array(b),q=0;q<b;++q)r[q]="a[i"+q+"]",s[q]="b[i"+q+"]";f.push("proto.transpose=function "+d+"_transpose("+k+"){"+k.map(function(a,b){return a+"=("+a+"===undefined?"+b+":"+a+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+d+"(this.data,"+r.join(",")+","+s.join(",")+",this.offset)}"),f.push("proto.pick=function "+d+"_pick("+k+"){var a=[],b=[],c=this.offset");for(var q=0;q<b;++q)f.push("if(typeof i"+q+"==='number'&&i"+q+">=0){c=(c+this.stride["+q+"]*i"+q+")|0}else{a.push(this.shape["+q+"]);b.push(this.stride["+q+"])}");f.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),f.push("return function construct_"+d+"(data,shape,stride,offset){return new "+d+"(data,"+j.map(function(a){return"shape["+a+"]"}).join(",")+","+j.map(function(a){return"stride["+a+"]"}).join(",")+",offset)}");var i=Function("CTOR_LIST","ORDER",f.join(`
`));return i(h[a],g)}(n,o.length-1));var j=o[k+1];return j(a,b,f,i)}}),q=j((a,b)=>{b.exports=function(a,b,c){return 0===a.length?a:b?(c||a.sort(b),function(a,b){for(var c=1,d=a.length,e=a[0],f=a[0],g=1;g<d;++g)if(f=e,b(e=a[g],f)){if(g===c){c++;continue}a[c++]=e}return a.length=c,a}(a,b)):(c||a.sort(),function(a){for(var b=1,c=a.length,d=a[0],e=a[0],f=1;f<c;++f,e=d)if(e=d,(d=a[f])!==e){if(f===b){b++;continue}a[b++]=d}return a.length=b,a}(a))}}),r=j((a,b)=>{var c=q();function d(a,b,c){var d,e,f=a.length,g=b.arrayArgs.length,h=b.indexArgs.length>0,i=[],j=[],k=0,l=0;for(d=0;d<f;++d)j.push("i"+d+"=0");for(e=0;e<g;++e)for(d=0;d<f;++d)l=k,k=a[d],0===d?j.push("d"+e+"s"+d+"=t"+e+"p"+k):j.push("d"+e+"s"+d+"=(t"+e+"p"+k+"-s"+l+"*t"+e+"p"+l+")");for(j.length>0&&i.push("var "+j.join(",")),d=f-1;d>=0;--d)k=a[d],i.push("for(i"+d+"=0;i"+d+"<s"+k+";++i"+d+"){");for(i.push(c),d=0;d<f;++d){for(l=k,k=a[d],e=0;e<g;++e)i.push("p"+e+"+=d"+e+"s"+d);h&&(d>0&&i.push("index["+l+"]-=s"+l),i.push("++index["+k+"]")),i.push("}")}return i.join(`
`)}function e(a,b,c){for(var d=a.body,e=[],f=[],g=0;g<a.args.length;++g){var h=a.args[g];if(!(h.count<=0)){var i=RegExp(h.name,"g"),j="",k=b.arrayArgs.indexOf(g);switch(b.argTypes[g]){case"offset":var l=b.offsetArgIndex.indexOf(g);k=b.offsetArgs[l].array,j="+q"+l;case"array":j="p"+k+j;var m="l"+g,n="a"+k;if(0===b.arrayBlockIndices[k])1===h.count?"generic"===c[k]?h.lvalue?(e.push("var "+m+"="+n+".get("+j+")"),d=d.replace(i,m),f.push(n+".set("+j+","+m+")")):d=d.replace(i,n+".get("+j+")"):d=d.replace(i,n+"["+j+"]"):"generic"===c[k]?(e.push("var "+m+"="+n+".get("+j+")"),d=d.replace(i,m),h.lvalue&&f.push(n+".set("+j+","+m+")")):(e.push("var "+m+"="+n+"["+j+"]"),d=d.replace(i,m),h.lvalue&&f.push(n+"["+j+"]="+m));else{for(var o=[h.name],p=[j],q=0;q<Math.abs(b.arrayBlockIndices[k]);q++)o.push("\\s*\\[([^\\]]+)\\]"),p.push("$"+(q+1)+"*t"+k+"b"+q);if(i=RegExp(o.join(""),"g"),j=p.join("+"),"generic"===c[k])throw Error("cwise: Generic arrays not supported in combination with blocks!");d=d.replace(i,n+"["+j+"]")}break;case"scalar":d=d.replace(i,"Y"+b.scalarArgs.indexOf(g));break;case"index":d=d.replace(i,"index");break;case"shape":d=d.replace(i,"shape")}}}return[e.join(`
`),d,f.join(`
`)].join(`
`).trim()}b.exports=function(a,b){for(var f=b[1].length-Math.abs(a.arrayBlockIndices[0])|0,g=Array(a.arrayArgs.length),h=Array(a.arrayArgs.length),i=0;i<a.arrayArgs.length;++i)h[i]=b[2*i],g[i]=b[2*i+1];for(var j=[],k=[],l=[],m=[],n=[],i=0;i<a.arrayArgs.length;++i){a.arrayBlockIndices[i]<0?(l.push(0),m.push(f),j.push(f),k.push(f+a.arrayBlockIndices[i])):(l.push(a.arrayBlockIndices[i]),m.push(a.arrayBlockIndices[i]+f),j.push(0),k.push(a.arrayBlockIndices[i]));for(var o=[],p=0;p<g[i].length;p++)l[i]<=g[i][p]&&g[i][p]<m[i]&&o.push(g[i][p]-l[i]);n.push(o)}for(var q=["SS"],r=["'use strict'"],s=[],p=0;p<f;++p)s.push("s"+p+"=SS["+p+"]");for(var i=0;i<a.arrayArgs.length;++i){q.push("a"+i),q.push("t"+i),q.push("p"+i);for(var p=0;p<f;++p)s.push("t"+i+"p"+p+"=t"+i+"["+(l[i]+p)+"]");for(var p=0;p<Math.abs(a.arrayBlockIndices[i]);++p)s.push("t"+i+"b"+p+"=t"+i+"["+(j[i]+p)+"]")}for(var i=0;i<a.scalarArgs.length;++i)q.push("Y"+i);if(a.shapeArgs.length>0&&s.push("shape=SS.slice(0)"),a.indexArgs.length>0){for(var t=Array(f),i=0;i<f;++i)t[i]="0";s.push("index=["+t.join(",")+"]")}for(var i=0;i<a.offsetArgs.length;++i){for(var u=a.offsetArgs[i],v=[],p=0;p<u.offset.length;++p)0!==u.offset[p]&&(1===u.offset[p]?v.push("t"+u.array+"p"+p):v.push(u.offset[p]+"*t"+u.array+"p"+p));0===v.length?s.push("q"+i+"=0"):s.push("q"+i+"="+v.join("+"))}var w=c([].concat(a.pre.thisVars).concat(a.body.thisVars).concat(a.post.thisVars));(s=s.concat(w)).length>0&&r.push("var "+s.join(","));for(var i=0;i<a.arrayArgs.length;++i)r.push("p"+i+"|=0");a.pre.body.length>3&&r.push(e(a.pre,a,h));var x=e(a.body,a,h),y=function(a){for(var b=0,c=a[0].length;b<c;){for(var d=1;d<a.length;++d)if(a[d][b]!==a[0][b])return b;++b}return b}(n);y<f?r.push(function(a,b,c,e){for(var f=b.length,g=c.arrayArgs.length,h=c.blockSize,i=c.indexArgs.length>0,j=[],k=0;k<g;++k)j.push("var offset"+k+"=p"+k);for(var k=a;k<f;++k)j.push("for(var j"+k+"=SS["+b[k]+"]|0;j"+k+">0;){"),j.push("if(j"+k+"<"+h+"){"),j.push("s"+b[k]+"=j"+k),j.push("j"+k+"=0"),j.push("}else{s"+b[k]+"="+h),j.push("j"+k+"-="+h+"}"),i&&j.push("index["+b[k]+"]=j"+k);for(var k=0;k<g;++k){for(var l=["offset"+k],m=a;m<f;++m)l.push("j"+m+"*t"+k+"p"+b[m]);j.push("p"+k+"=("+l.join("+")+")")}j.push(d(b,c,e));for(var k=a;k<f;++k)j.push("}");return j.join(`
`)}(y,n[0],a,x)):r.push(d(n[0],a,x)),a.post.body.length>3&&r.push(e(a.post,a,h)),a.debug&&console.log("-----Generated cwise routine for ",b,`:
`+r.join(`
`)+`
----------`);var z=(a.funcName||"unnamed")+"_cwise_loop_"+g[0].join("s")+"m"+y+function(a){for(var b=Array(a.length),c=!0,d=0;d<a.length;++d){var e=a[d],f=e.match(/\d+/);f=f?f[0]:"",0===e.charAt(0)?b[d]="u"+e.charAt(1)+f:b[d]=e.charAt(0)+f,d>0&&(c=c&&b[d]===b[d-1])}return c?b[0]:b.join("")}(h);return Function("function "+z+"("+q.join(",")+"){"+r.join(`
`)+"} return "+z)()}}),s=j((a,b)=>{var c=r();b.exports=function(a){var b=["'use strict'","var CACHED={}"],d=[];b.push("return function "+a.funcName+"_cwise_thunk("+a.shimArgs.join(",")+"){");for(var e=[],f=[],g=["array"+a.arrayArgs[0]+".shape.slice("+Math.max(0,a.arrayBlockIndices[0])+(a.arrayBlockIndices[0]<0?","+a.arrayBlockIndices[0]+")":")")],h=[],i=[],j=0;j<a.arrayArgs.length;++j){var k=a.arrayArgs[j];d.push("t"+k+"=array"+k+".dtype,r"+k+"=array"+k+".order"),e.push("t"+k),e.push("r"+k),f.push("t"+k),f.push("r"+k+".join()"),g.push("array"+k+".data"),g.push("array"+k+".stride"),g.push("array"+k+".offset|0"),j>0&&(h.push("array"+a.arrayArgs[0]+".shape.length===array"+k+".shape.length+"+(Math.abs(a.arrayBlockIndices[0])-Math.abs(a.arrayBlockIndices[j]))),i.push("array"+a.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,a.arrayBlockIndices[0])+"]===array"+k+".shape[shapeIndex+"+Math.max(0,a.arrayBlockIndices[j])+"]"))}a.arrayArgs.length>1&&(b.push("if (!("+h.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),b.push("for(var shapeIndex=array"+a.arrayArgs[0]+".shape.length-"+Math.abs(a.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),b.push("if (!("+i.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),b.push("}"));for(var j=0;j<a.scalarArgs.length;++j)g.push("scalar"+a.scalarArgs[j]);return d.push("type=["+f.join(",")+"].join()"),d.push("proc=CACHED[type]"),b.push("var "+d.join(",")),b.push("if(!proc){CACHED[type]=proc=compile(["+e.join(",")+"])}return proc("+g.join(",")+")}"),a.debug&&console.log(`-----Generated thunk:
`+b.join(`
`)+`
----------`),Function("compile",b.join(`
`))(c.bind(void 0,a))}}),t=j((a,b)=>{var c=s();function d(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}b.exports=function(a){var b=new d;b.pre=a.pre,b.body=a.body,b.post=a.post;var e=a.args.slice(0);b.argTypes=e;for(var f=0;f<e.length;++f){var g=e[f];if("array"===g||"object"==typeof g&&g.blockIndices){if(b.argTypes[f]="array",b.arrayArgs.push(f),b.arrayBlockIndices.push(g.blockIndices?g.blockIndices:0),b.shimArgs.push("array"+f),f<b.pre.args.length&&b.pre.args[f].count>0)throw Error("cwise: pre() block may not reference array args");if(f<b.post.args.length&&b.post.args[f].count>0)throw Error("cwise: post() block may not reference array args")}else if("scalar"===g)b.scalarArgs.push(f),b.shimArgs.push("scalar"+f);else if("index"===g){if(b.indexArgs.push(f),f<b.pre.args.length&&b.pre.args[f].count>0)throw Error("cwise: pre() block may not reference array index");if(f<b.body.args.length&&b.body.args[f].lvalue)throw Error("cwise: body() block may not write to array index");if(f<b.post.args.length&&b.post.args[f].count>0)throw Error("cwise: post() block may not reference array index")}else if("shape"===g){if(b.shapeArgs.push(f),f<b.pre.args.length&&b.pre.args[f].lvalue)throw Error("cwise: pre() block may not write to array shape");if(f<b.body.args.length&&b.body.args[f].lvalue)throw Error("cwise: body() block may not write to array shape");if(f<b.post.args.length&&b.post.args[f].lvalue)throw Error("cwise: post() block may not write to array shape")}else if("object"==typeof g&&g.offset)b.argTypes[f]="offset",b.offsetArgs.push({array:g.array,offset:g.offset}),b.offsetArgIndex.push(f);else throw Error("cwise: Unknown argument type "+e[f])}if(b.arrayArgs.length<=0)throw Error("cwise: No array arguments specified");if(b.pre.args.length>e.length)throw Error("cwise: Too many arguments in pre() block");if(b.body.args.length>e.length)throw Error("cwise: Too many arguments in body() block");if(b.post.args.length>e.length)throw Error("cwise: Too many arguments in post() block");return b.debug=!!a.printCode||!!a.debug,b.funcName=a.funcName||"cwise",b.blockSize=a.blockSize||64,c(b)}}),u=j(a=>{var b=t(),c={body:"",args:[],thisVars:[],localVars:[]};function d(a){if(!a)return c;for(var b=0;b<a.args.length;++b){var d=a.args[b];0===b?a.args[b]={name:d,lvalue:!0,rvalue:!!a.rvalue,count:a.count||1}:a.args[b]={name:d,lvalue:!1,rvalue:!0,count:1}}return a.thisVars||(a.thisVars=[]),a.localVars||(a.localVars=[]),a}function e(a){for(var c=[],e=0;e<a.args.length;++e)c.push("a"+e);return Function("P","return function "+a.funcName+"_ndarrayops("+c.join(",")+") {P("+c.join(",")+");return a0}")(b({args:a.args,pre:d(a.pre),body:d(a.body),post:d(a.proc),funcName:a.funcName}))}var f={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var b in f){var c=f[b];a[b]=e({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+c+"c"},funcName:b}),a[b+"eq"]=e({args:["array","array"],body:{args:["a","b"],body:"a"+c+"=b"},rvalue:!0,funcName:b+"eq"}),a[b+"s"]=e({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+c+"s"},funcName:b+"s"}),a[b+"seq"]=e({args:["array","scalar"],body:{args:["a","s"],body:"a"+c+"=s"},rvalue:!0,funcName:b+"seq"})}}();var g={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var b in g){var c=g[b];a[b]=e({args:["array","array"],body:{args:["a","b"],body:"a="+c+"b"},funcName:b}),a[b+"eq"]=e({args:["array"],body:{args:["a"],body:"a="+c+"a"},rvalue:!0,count:2,funcName:b+"eq"})}}();var h={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var b in h){var c=h[b];a[b]=e({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+c+"c"},funcName:b}),a[b+"s"]=e({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+c+"s"},funcName:b+"s"}),a[b+"eq"]=e({args:["array","array"],body:{args:["a","b"],body:"a=a"+c+"b"},rvalue:!0,count:2,funcName:b+"eq"}),a[b+"seq"]=e({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+c+"s"},rvalue:!0,count:2,funcName:b+"seq"})}}();var i=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var b=0;b<i.length;++b){var c=i[b];a[c]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:c}),a[c+"eq"]=e({args:["array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"eq"})}}();var j=["max","min","atan2","pow"];!function(){for(var b=0;b<j.length;++b){var c=j[b];a[c]=e({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:c}),a[c+"s"]=e({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:c+"s"}),a[c+"eq"]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"eq"}),a[c+"seq"]=e({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"seq"})}}();var k=["atan2","pow"];!function(){for(var b=0;b<k.length;++b){var c=k[b];a[c+"op"]=e({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:c+"op"}),a[c+"ops"]=e({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:c+"ops"}),a[c+"opeq"]=e({args:["array","array"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"opeq"}),a[c+"opseq"]=e({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+c,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:c+"opseq"})}}(),a.any=b({args:["array"],pre:c,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),a.all=b({args:["array"],pre:c,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),a.sum=b({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),a.prod=b({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),a.norm2squared=b({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),a.norm2=b({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),a.norminf=b({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),a.norm1=b({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),a.sup=b({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),a.inf=b({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),a.argmin=b({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),a.argmax=b({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),a.random=e({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),a.assign=e({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),a.assigns=e({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),a.equals=b({args:["array","array"],pre:c,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})}),v=l(p(),1),w=l(u(),1),x=l(p(),1),y=l(u(),1),z=class{constructor(a,b,c){this._dataNormalized=a,this._minD=b,this._maxD=c}static createFromUnnormalized(a){let b=y.sup(a),c=y.inf(a),d=(0,x.default)(new Float32Array(a.size),a.shape),e=b-c;return e<1e-4?y.assigns(d,0):(y.subs(d,a,c),y.divs(d,d,e)),new z(d,c,b)}get data(){return this._dataNormalized}get minD(){return this._minD}get maxD(){return this._maxD}denormalize(){let a=(0,x.default)(new Float32Array(this._dataNormalized.size),this._dataNormalized.shape);return y.muls(a,this._dataNormalized,this._maxD-this._minD),y.adds(a,a,this._minD),a}},A=class{constructor(a,b){this._quantized=a,this._method=b}get quantized(){return this._quantized}static maxIntBits(a){return 2**a-1}static fromNormalized(a,b){let c=a.data,d;if("norm8x"===b){let a=A.maxIntBits(8),b=(0,x.default)(new Float32Array(c.size),c.shape);y.muls(b,c,a),y.roundeq(b),d=(0,x.default)(new Uint8Array(b.data),c.shape)}else if("norm565"===b){let a=(0,x.default)(new Float32Array(c.size),c.shape);y.assign(a,c),y.mulseq(a.pick(null,0),A.maxIntBits(5)),y.mulseq(a.pick(null,1),A.maxIntBits(6)),y.mulseq(a.pick(null,2),A.maxIntBits(5)),y.roundeq(a);let b=(0,x.default)(new Uint16Array(a.data),c.shape),e=(0,x.default)(new Uint16Array(c.shape[0]),[c.shape[0]]),f=(0,x.default)(new Uint16Array(c.shape[0]),[c.shape[0]]);y.lshifts(e,b.pick(null,0),11),y.lshifts(f,b.pick(null,1),5),y.boreq(e,f),y.boreq(e,b.pick(null,2)),d=e}else{let a=(0,x.default)(new Float32Array(c.size),c.shape);y.assign(a,c),y.mulseq(a.pick(null,0),A.maxIntBits(11)),y.mulseq(a.pick(null,1),A.maxIntBits(10)),y.mulseq(a.pick(null,2),A.maxIntBits(11)),y.roundeq(a);let b=(0,x.default)(new Uint32Array(a.data),c.shape),e=(0,x.default)(new Uint32Array(c.shape[0]),[c.shape[0]]),f=(0,x.default)(new Uint32Array(c.shape[0]),[c.shape[0]]);y.lshifts(e,b.pick(null,0),21),y.lshifts(f,b.pick(null,1),11),y.boreq(e,f),y.boreq(e,b.pick(null,2)),d=e}return new A(d,b)}dequantize(a,b){let c=this._method,d,e=this._quantized;if("norm8x"===c){let a=A.maxIntBits(8);d=(0,x.default)(new Float32Array(e.size),e.shape),y.muls(d,e,1/a)}else if("norm565"===c){let a=(0,x.default)(new Uint8Array(e.shape[0]),[e.shape[0]]),b=(0,x.default)(new Uint8Array(e.shape[0]),[e.shape[0]]),c=(0,x.default)(new Uint8Array(e.shape[0]),[e.shape[0]]);y.rrshifts(a,e,11),y.rrshifts(b,e,5),y.bandseq(b,A.maxIntBits(6)),y.bands(c,e,A.maxIntBits(5)),d=(0,x.default)(new Float32Array(3*e.shape[0]),[e.shape[0],3]),y.muls(d.pick(null,0),a,1/A.maxIntBits(5)),y.muls(d.pick(null,1),b,1/A.maxIntBits(6)),y.muls(d.pick(null,2),c,1/A.maxIntBits(5))}else{let a=(0,x.default)(new Uint16Array(e.shape[0]),[e.shape[0]]),b=(0,x.default)(new Uint16Array(e.shape[0]),[e.shape[0]]),c=(0,x.default)(new Uint16Array(e.shape[0]),[e.shape[0]]);y.rrshifts(a,e,21),y.rrshifts(b,e,11),y.bandseq(b,A.maxIntBits(10)),y.bands(c,e,A.maxIntBits(11)),d=(0,x.default)(new Float32Array(3*e.shape[0]),[e.shape[0],3]),y.muls(d.pick(null,0),a,1/A.maxIntBits(11)),y.muls(d.pick(null,1),b,1/A.maxIntBits(10)),y.muls(d.pick(null,2),c,1/A.maxIntBits(11))}return new z(d,a,b)}},B=class{constructor(a,b,c,d,e,f=!1){this._quantized=a,this._minMaxMatrix=b,this._chunkSize=c,this._quantizationMethod=d,this._variableChunkSize=e,this._isDynamicChunks=f}get length(){return this._quantized.shape[0]}get nchunks(){return this._minMaxMatrix.shape[0]}get quantized(){return this._quantized}get method(){return this._quantizationMethod}get minmaxMatrix(){return this._minMaxMatrix}_createPrunedMinMax(a){let b=a.length,c=this.minmaxMatrix.shape[0]-b,d=(0,v.default)(new Float32Array(2*c),[c,2]),e=0,f=c,g=0,h=this.minmaxMatrix.shape[0];for(let b=0;b<a.length;b++)(f=(h=a[b])-g+e)>e&&w.assign(d.hi(f,2).lo(e,0),this.minmaxMatrix.hi(h,2).lo(g,0)),e=f,g=h+1;return e<c&&w.assign(d.lo(e,0),this.minmaxMatrix.lo(g,0)),d}_createPrunedQuantized(a){let b=a.length,c=this.quantized.shape[0]-b,d=this._quantizationMethod,e,f;if("norm8x"===d){let a=(f=this._quantized.shape[1])?c*f:c;e=(0,v.default)(new Uint8Array(a),f?[c,f]:[c,1])}else e="norm565"===d?(0,v.default)(new Uint16Array(c),[c]):(0,v.default)(new Uint32Array(c),[c]);let g=0,h=c,i=0,j=e.shape[0];for(let b=0;b<a.length;b++)(h=(j=a[b])-i+g)>g&&(f?w.assign(e.hi(h,f).lo(g,0),this._quantized.hi(j,f).lo(i,0)):w.assign(e.hi(h).lo(g),this._quantized.hi(j).lo(i))),g=h,i=j+1;return g<c&&(f?w.assign(e.lo(g,0),this._quantized.lo(i,0)):w.assign(e.lo(g),this._quantized.lo(i))),e}pruneFeature(a,b,c){return new B(this._createPrunedQuantized(a),this._createPrunedMinMax(b),this._chunkSize,this._quantizationMethod,c,!0)}static getRequiredNChunks(a,b){return Math.floor(a/b)}static fromArray(a,b,c){let d=a.shape[0],e=Math.floor(d/c),f=(0,v.default)(new Float32Array(2*e),[e,2],[2,1]),g;g="norm8x"===b?(0,v.default)(new Uint8Array(a.size),a.shape):"norm565"===b?(0,v.default)(new Uint16Array(a.shape[0]),[a.shape[0]]):(0,v.default)(new Uint32Array(a.shape[0]),[a.shape[0]]);for(let h=0;h<e;h++){let i=h*c,j=h+1<e?(h+1)*c:d,k;k=a.shape.length>1?z.createFromUnnormalized(a.hi(j,a.shape[1]).lo(i,0)):z.createFromUnnormalized(a.hi(j).lo(i)),f.set(h,0,k.minD),f.set(h,1,k.maxD),g.shape.length>1?w.assign(g.hi(j,g.shape[1]).lo(i,0),A.fromNormalized(k,b).quantized):w.assign(g.hi(j).lo(i),A.fromNormalized(k,b).quantized)}return new B(g,f,c,b)}denormDequant(){let a,b=this._minMaxMatrix.shape[0],c=this._quantized,d=c.shape[0],e=this._quantizationMethod,f=this._chunkSize,g;if(this._isDynamicChunks){if(!this._variableChunkSize)throw Error("variable chunk must exists if chunkSize isDynamic");g=this._variableChunkSize}a="norm8x"===e?(0,v.default)(new Float32Array(c.size),c.shape):(0,v.default)(new Float32Array(3*d),[d,3]);let h=0,i=f;for(let f=0;f<b;f++){let[j,k]=[this._minMaxMatrix.get(f,0),this._minMaxMatrix.get(f,1)];this._isDynamicChunks&&(i=g[f]);let l=f+1<b?h+i:d,m;m=c.shape.length>1?new A(c.hi(l,c.shape[1]).lo(h,0),e):new A(c.hi(l).lo(h),e),w.assign(a.hi(l,a.shape[1]).lo(h,0),m.dequantize(j,k).denormalize()),h=l}return a}static async fetchArrayBuffer(a){return await (await fetch(a,{mode:"cors"})).arrayBuffer()}},C=l(p(),1),D=l(u(),1),E=l(p(),1),F=l(u(),1),G=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9];function H(a){return a<1e5?a<100?a<10?0:1:a<1e4?a<1e3?2:3:4:a<1e7?a<1e6?5:6:a<1e9?a<1e8?7:8:9}function I(a,b){if(a===b)return 0;if(~~a===a&&~~b===b){if(0===a||0===b)return a<b?-1:1;if(a<0||b<0){if(b>=0)return -1;if(a>=0)return 1;a=-a,b=-b}let c=H(a),d=H(b),e=0;return c<d?(a*=G[d-c-1],b/=10,e=-1):c>d&&(b*=G[c-d-1],a/=10,e=1),a===b?e:a<b?-1:1}let c=String(a),d=String(b);return c===d?0:c<d?-1:1}function J(a,b,c,d){let e=b+1;if(e===c)return 1;if(0>d(a[e++],a[b])){for(;e<c&&0>d(a[e],a[e-1]);)e++;var f=a,g=b,h=e;for(h--;g<h;){let a=f[g];f[g++]=f[h],f[h--]=a}}else for(;e<c&&d(a[e],a[e-1])>=0;)e++;return e-b}function K(a,b,c,d,e){for(d===b&&d++;d<c;d++){let c=a[d],f=b,g=d;for(;f<g;){let b=f+g>>>1;0>e(c,a[b])?g=b:f=b+1}let h=d-f;switch(h){case 3:a[f+3]=a[f+2];case 2:a[f+2]=a[f+1];case 1:a[f+1]=a[f];break;default:for(;h>0;)a[f+h]=a[f+h-1],h--}a[f]=c}}function L(a,b,c,d,e,f){let g=0,h=0,i=1;if(f(a,b[c+e])>0){for(h=d-e;i<h&&f(a,b[c+e+i])>0;)g=i,(i=(i<<1)+1)<=0&&(i=h);i>h&&(i=h),g+=e,i+=e}else{for(h=e+1;i<h&&0>=f(a,b[c+e-i]);)g=i,(i=(i<<1)+1)<=0&&(i=h);i>h&&(i=h);let d=g;g=e-i,i=e-d}for(g++;g<i;){let d=g+(i-g>>>1);f(a,b[c+d])>0?g=d+1:i=d}return i}function M(a,b,c,d,e,f){let g=0,h=0,i=1;if(0>f(a,b[c+e])){for(h=e+1;i<h&&0>f(a,b[c+e-i]);)g=i,(i=(i<<1)+1)<=0&&(i=h);i>h&&(i=h);let d=g;g=e-i,i=e-d}else{for(h=d-e;i<h&&f(a,b[c+e+i])>=0;)g=i,(i=(i<<1)+1)<=0&&(i=h);i>h&&(i=h),g+=e,i+=e}for(g++;g<i;){let d=g+(i-g>>>1);0>f(a,b[c+d])?i=d:g=d+1}return i}var N=class{constructor(a,b){m(this,"array",null),m(this,"compare",null),m(this,"minGallop",7),m(this,"length",0),m(this,"tmpStorageLength",256),m(this,"stackLength",0),m(this,"runStart",null),m(this,"runLength",null),m(this,"stackSize",0),this.array=a,this.compare=b,this.length=a.length,this.length<512&&(this.tmpStorageLength=this.length>>>1),this.tmp=Array(this.tmpStorageLength),this.stackLength=this.length<120?5:this.length<1542?10:this.length<119151?19:40,this.runStart=Array(this.stackLength),this.runLength=Array(this.stackLength)}pushRun(a,b){this.runStart[this.stackSize]=a,this.runLength[this.stackSize]=b,this.stackSize+=1}mergeRuns(){for(;this.stackSize>1;){let a=this.stackSize-2;if(a>=1&&this.runLength[a-1]<=this.runLength[a]+this.runLength[a+1]||a>=2&&this.runLength[a-2]<=this.runLength[a]+this.runLength[a-1])this.runLength[a-1]<this.runLength[a+1]&&a--;else if(this.runLength[a]>this.runLength[a+1])break;this.mergeAt(a)}}forceMergeRuns(){for(;this.stackSize>1;){let a=this.stackSize-2;a>0&&this.runLength[a-1]<this.runLength[a+1]&&a--,this.mergeAt(a)}}mergeAt(a){let b=this.compare,c=this.array,d=this.runStart[a],e=this.runLength[a],f=this.runStart[a+1],g=this.runLength[a+1];this.runLength[a]=e+g,a===this.stackSize-3&&(this.runStart[a+1]=this.runStart[a+2],this.runLength[a+1]=this.runLength[a+2]),this.stackSize--;let h=M(c[f],c,d,e,0,b);d+=h,0!=(e-=h)&&0!==(g=L(c[d+e-1],c,f,g,g-1,b))&&(e<=g?this.mergeLow(d,e,f,g):this.mergeHigh(d,e,f,g))}mergeLow(a,b,c,d){let e=this.compare,f=this.array,g=this.tmp,h=0;for(h=0;h<b;h++)g[h]=f[a+h];let i=0,j=c,k=a;if(f[k++]=f[j++],0==--d){for(h=0;h<b;h++)f[k+h]=g[i+h];return}if(1===b){for(h=0;h<d;h++)f[k+h]=f[j+h];f[k+d]=g[i];return}let l=this.minGallop;for(;;){let a=0,c=0,m=!1;do if(0>e(f[j],g[i])){if(f[k++]=f[j++],c++,a=0,0==--d){m=!0;break}}else if(f[k++]=g[i++],a++,c=0,1==--b){m=!0;break}while((a|c)<l);if(m)break;do{if(0!==(a=M(f[j],g,i,b,0,e))){for(h=0;h<a;h++)f[k+h]=g[i+h];if(k+=a,i+=a,(b-=a)<=1){m=!0;break}}if(f[k++]=f[j++],0==--d){m=!0;break}if(0!==(c=L(g[i],f,j,d,0,e))){for(h=0;h<c;h++)f[k+h]=f[j+h];if(k+=c,j+=c,0==(d-=c)){m=!0;break}}if(f[k++]=g[i++],1==--b){m=!0;break}l--}while(a>=7||c>=7);if(m)break;l<0&&(l=0),l+=2}if(this.minGallop=l,l<1&&(this.minGallop=1),1===b){for(h=0;h<d;h++)f[k+h]=f[j+h];f[k+d]=g[i]}else{if(0===b)throw Error("mergeLow preconditions were not respected");for(h=0;h<b;h++)f[k+h]=g[i+h]}}mergeHigh(a,b,c,d){let e=this.compare,f=this.array,g=this.tmp,h=0;for(h=0;h<d;h++)g[h]=f[c+h];let i=a+b-1,j=d-1,k=c+d-1,l=0,m=0;if(f[k--]=f[i--],0==--b){for(l=k-(d-1),h=0;h<d;h++)f[l+h]=g[h];return}if(1===d){for(k-=b,i-=b,m=k+1,l=i+1,h=b-1;h>=0;h--)f[m+h]=f[l+h];f[k]=g[j];return}let n=this.minGallop;for(;;){let c=0,o=0,p=!1;do if(0>e(g[j],f[i])){if(f[k--]=f[i--],c++,o=0,0==--b){p=!0;break}}else if(f[k--]=g[j--],o++,c=0,1==--d){p=!0;break}while((c|o)<n);if(p)break;do{if(0!=(c=b-M(g[j],f,a,b,b-1,e))){for(k-=c,i-=c,b-=c,m=k+1,l=i+1,h=c-1;h>=0;h--)f[m+h]=f[l+h];if(0===b){p=!0;break}}if(f[k--]=g[j--],1==--d){p=!0;break}if(0!=(o=d-L(f[i],g,0,d,d-1,e))){for(k-=o,j-=o,d-=o,m=k+1,l=j+1,h=0;h<o;h++)f[m+h]=g[l+h];if(d<=1){p=!0;break}}if(f[k--]=f[i--],0==--b){p=!0;break}n--}while(c>=7||o>=7);if(p)break;n<0&&(n=0),n+=2}if(this.minGallop=n,n<1&&(this.minGallop=1),1===d){for(k-=b,i-=b,m=k+1,l=i+1,h=b-1;h>=0;h--)f[m+h]=f[l+h];f[k]=g[j]}else{if(0===d)throw Error("mergeHigh preconditions were not respected");for(l=k-(d-1),h=0;h<d;h++)f[l+h]=g[h]}}};function O(a){let b=(0,E.default)(new Int32Array(a.shape[0]),[a.shape[0]]),c=(0,E.default)(new Int32Array(a.shape[0]),[a.shape[0]]);return F.bands(b,a,1023),F.lshifts(c,b,16),F.bxoreq(b,c),F.bandseq(b,0xff0000ff),F.lshifts(c,b,8),F.bxoreq(b,c),F.bandseq(b,0x300f00f),F.lshifts(c,b,4),F.bxoreq(b,c),F.bandseq(b,0x30c30c3),F.lshifts(c,b,2),F.bxoreq(b,c),F.bandseq(b,0x9249249),b}function P(a,b){if(a.shape[0]!==b.shape[0])throw Error("wrong length");let c=(0,E.default)(new Float32Array(a.size),a.shape,a.stride,a.offset);for(let d=0;d<b.shape[0];d++){let e=b.get(d);if(a.shape.length>1)for(let b=0;b<a.shape[1];b++)c.set(d,b,a.get(e,b));else c.set(d,a.get(e))}return c}var Q=class{constructor(a,b,c,d,e,f,g,h,i,j){this.propertyDescs=a,this.format=b,this.nsplats=c,this.xyz=d,this.colors=e,this.harmonics=f,this.opacity=g,this.scaling=h,this.rotation=i,this.maxSHDegree=j}getPlyBinary(){let a=Q._generateHeaderString(this.propertyDescs,this.format,this.nsplats),b=new TextEncoder().encode(a),c=Object.keys(this.propertyDescs).length,d=(0,C.default)(new Float32Array(this.nsplats*c),[this.nsplats,c]);if(D.assign(d.pick(null,this.propertyDescs.x.index),this.xyz.pick(null,0)),D.assign(d.pick(null,this.propertyDescs.y.index),this.xyz.pick(null,1)),D.assign(d.pick(null,this.propertyDescs.z.index),this.xyz.pick(null,2)),D.assign(d.pick(null,this.propertyDescs.f_dc_0.index),this.colors.pick(null,0)),D.assign(d.pick(null,this.propertyDescs.f_dc_1.index),this.colors.pick(null,1)),D.assign(d.pick(null,this.propertyDescs.f_dc_2.index),this.colors.pick(null,2)),D.assign(d.pick(null,this.propertyDescs.opacity.index),this.opacity.pick(null,0)),D.assign(d.pick(null,this.propertyDescs.scale_0.index),this.scaling.pick(null,0)),D.assign(d.pick(null,this.propertyDescs.scale_1.index),this.scaling.pick(null,1)),D.assign(d.pick(null,this.propertyDescs.scale_2.index),this.scaling.pick(null,2)),D.assign(d.pick(null,this.propertyDescs.rot_0.index),this.rotation.pick(null,0)),D.assign(d.pick(null,this.propertyDescs.rot_1.index),this.rotation.pick(null,1)),D.assign(d.pick(null,this.propertyDescs.rot_2.index),this.rotation.pick(null,2)),D.assign(d.pick(null,this.propertyDescs.rot_3.index),this.rotation.pick(null,3)),this.harmonics&&this.harmonics.length>0)for(let a=0;a<this.harmonics.length;a++){let b=3*a;D.assign(d.pick(null,this.propertyDescs[`f_rest_${b}`].index),this.harmonics[a].pick(null,0)),D.assign(d.pick(null,this.propertyDescs[`f_rest_${b+1}`].index),this.harmonics[a].pick(null,1)),D.assign(d.pick(null,this.propertyDescs[`f_rest_${b+2}`].index),this.harmonics[a].pick(null,2))}let e=new Uint8Array(d.data.buffer),f=new Uint8Array(e.length+b.length);return f.set(b),f.set(e,b.length),f.buffer}save(a,b){let c=new File([new Blob([this.getPlyBinary()],{type:"application/octet-stream"})],a),d=new FormData;d.append("file",c),d.append("filename",a),d.append("basedir",b),fetch("http://127.0.0.1:8000/push_file",{method:"POST",body:d})}static async loadFile(a){return await (await fetch(a)).arrayBuffer()}mortonPositionSplatsSort(){var a,b;let c,d,e,f,g,h,i,j=(a=this.xyz,c=1e3/Math.min(1e3,F.sup(a)-F.inf(a)),d=(0,E.default)(new Float32Array(a.data),a.shape),F.mulseq(d,c),!function(a,b,c,d){if(!Array.isArray(a))throw TypeError("Can only sort arrays");b?"function"!=typeof b&&(d=c,c=b,b=I):b=I,c||(c=0),d||(d=a.length);let e=d-c;if(e<2)return;let f=0;if(e<32){f=J(a,c,d,b),K(a,c,d,c+f,b);return}let g=new N(a,b),h=function(a){let b=0;for(;a>=32;)b|=1&a,a>>=1;return a+b}(e);do{if((f=J(a,c,d,b))<h){let d=e;d>h&&(d=h),K(a,c,c+d,c+f,b),f=d}g.pushRun(c,f),g.mergeRuns(),e-=f,c+=f}while(0!==e);g.forceMergeRuns()}(h=Array.from((e=O((b=(0,E.default)(new Int32Array(d.data),a.shape)).pick(null,0)),f=O(b.pick(null,1)),F.lshiftseq(f,1),g=O(b.pick(null,2)),F.lshiftseq(g,2),F.boreq(e,f),F.boreq(e,g),e).data).map((a,b)=>[a,b]),(a,b)=>a[0]-b[0]),i=h.map(([a,b])=>b),(0,E.default)(Uint32Array.from(i))),k=P(this.xyz,j),l=P(this.colors,j),m=P(this.opacity,j),n=P(this.scaling,j),o=P(this.rotation,j),p=[];for(let a=0;a<this.harmonics.length;a++)p.push(P(this.harmonics[a],j));return new Q(this.propertyDescs,this.format,this.nsplats,k,l,p,m,n,o,this.maxSHDegree)}static _generateHeaderString(a,b,c){let d=`ply
format ${b.format} ${b.version}
element vertex ${c}`,e=Array(Object.keys(a).length);for(let b in a){let c=a[b];e[c.index]={name:b,dtype:c.dtype}}for(let a=0;a<e.length;a++)d=`${d}
property ${e[a].dtype} ${e[a].name}`;return`${d}
end_header
`}static fromArrayBuffer(a,b=3){let{splatCount:c,vertexData:d,propertiesDesc:e,format:f}=Q.decodeHeader(a),g=d.buffer.slice(d.byteOffset),h=Object.keys(e).length,i=(0,C.default)(new Float32Array(g),[c,h]),j=0,k={},l={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,char:1};for(let a in e)if(e.hasOwnProperty(a)){let b=e[a].dtype;k[a]=j,j+=l[b]}let m=(0,C.default)(new Float32Array(3*c),[c,3]);D.assign(m.pick(null,0),i.pick(null,k.x/4)),D.assign(m.pick(null,1),i.pick(null,k.y/4)),D.assign(m.pick(null,2),i.pick(null,k.z/4));let n=(0,C.default)(new Float32Array(3*c),[c,3]);D.assign(n.pick(null,0),i.pick(null,k.scale_0/4)),D.assign(n.pick(null,1),i.pick(null,k.scale_1/4)),D.assign(n.pick(null,2),i.pick(null,k.scale_2/4));let o=(0,C.default)(new Float32Array(3*c),[c,3]);D.assign(o.pick(null,0),i.pick(null,k.f_dc_0/4)),D.assign(o.pick(null,1),i.pick(null,k.f_dc_1/4)),D.assign(o.pick(null,2),i.pick(null,k.f_dc_2/4));let p=(0,C.default)(new Float32Array(4*c),[c,4]);D.assign(p.pick(null,0),i.pick(null,k.rot_1/4)),D.assign(p.pick(null,1),i.pick(null,k.rot_2/4)),D.assign(p.pick(null,2),i.pick(null,k.rot_3/4)),D.assign(p.pick(null,3),i.pick(null,k.rot_0/4));for(let a=0;a<c;a++){let b=p.pick(a,null),c=Math.sqrt(b.get(0)**2+b.get(1)**2+b.get(2)**2+b.get(3)**2);D.divseq(b,c)}let q=(0,C.default)(new Float32Array(+c),[c,1]);D.assign(q.pick(null,0),i.pick(null,k.opacity/4)),D.negeq(q),D.expeq(q),D.addseq(q,1),D.recipeq(q),D.mulseq(q,255);let r=(Math.min(Math.max(b,0),3)+1)**2-1,s=[];for(let a=0;a<r;a++){let b=(0,C.default)(new Float32Array(3*c),[c,3]),d=3*a;D.assign(b.pick(null,0),i.pick(null,k[`f_rest_${d}`]/4)),D.assign(b.pick(null,1),i.pick(null,k[`f_rest_${d+1}`]/4)),D.assign(b.pick(null,2),i.pick(null,k[`f_rest_${d+2}`]/4)),s.push(b)}return new Q(e,f,c,m,o,s,q,n,p,b)}static async fromPLYFile(a,b=3){let c=await Q.loadFile(a);return Q.fromArrayBuffer(c,b)}static decodeHeader(a){let b=new TextDecoder,c=0,d="";for(;;){if(c+100>=a.byteLength)throw Error("End of file reached while searching for end of header");let e=new Uint8Array(a,c,100);d+=b.decode(e);let f=(c+=100)-200,g=new Uint8Array(a,Math.max(0,f),f>0?200:100);if(b.decode(g).includes("end_header"))break}let e=d.split(`
`),f=0,g={},h={},i=0,j;for(let a=0;a<e.length;a++){let b=e[a].trim();if(b.startsWith("element vertex")){let a=b.match(/\d+/);a&&(f=parseInt(a[0]))}else if(b.startsWith("property")){let a=b.match(/(\w+)\s+(\w+)\s+(\w+)/);if(a){let b=a[2],c=a[3];g[c]=i,h[c]={dtype:b,index:i},i++}}else if(b.startsWith("format")){let a=b.match(/(\w+)\s+(\w+)\s+(\d+\.?\d*)/);a&&(j={format:a[2],version:a[3]})}else if("end_header"===b)break}return{splatCount:f,vertexData:new DataView(a,d.indexOf("end_header")+10+1),headerOffset:c,propertiesDesc:h,format:j}}},R=class{constructor(a,b,c,d,e,f,g,h){this.config=a,this.xyz=b,this.scaling=c,this.color=d,this.opacity=e,this.harmonics=g,this.quaternion=f,this.variableChunkSize=h}get isDynamicChunks(){return this.variableChunkSize&&this.variableChunkSize.length>0}get nchunks(){return this.xyz.nchunks}get nsplats(){return this.xyz.length}get chunkSize(){return this.config.chunkSize}static compressFromGaussianData(a,b){let c=B.fromArray(a.xyz,b.xyz,b.chunkSize),d=B.fromArray(a.scaling,b.scaling,b.chunkSize),e=B.fromArray(a.colors,b.color,b.chunkSize),f=B.fromArray(a.opacity,b.opacity,b.chunkSize),g=B.fromArray(a.rotation,b.quaternion,b.chunkSize),h=a.harmonics,i=[];if(b.harmonics)for(let a=0;a<h.length;a++){let c=B.fromArray(h[a],b.harmonics,b.chunkSize);i.push(c)}return new R(b,c,d,e,f,g,i)}_countIndexesInChunks(a){let b=[],c=this.nchunks,d=this.chunkSize,e=this.nsplats;if(c===B.getRequiredNChunks(e,d))for(let c=0;c<a.length;c++){let d=a[c],e=Math.floor(d/this.chunkSize);e in b?b[e].push(d):b[e]=[d]}else{let e=this.variableChunkSize,f={},g=0;for(let a=0;a<c;a++)f[a]=g,g+=e[a];for(let g=0;g<a.length;g++){let h=a[g],i=Math.min(Math.floor(h/d),c-1);for(;h>=f[i]+e[i];)i++;i in b?b[i].push(h):b[i]=[h]}}return b}pruneSplats(a){let b=this._countIndexesInChunks(a),c,d=[];return b.length>0&&(c=this.variableChunkSize?[...this.variableChunkSize]:Array(this.nchunks).fill(this.chunkSize),b.forEach((a,b)=>{c[b]-=a.length,c[b]<=0&&d.push(b)}),c=c.filter(a=>a>0)),new R(this.config,this.xyz.pruneFeature(a,d,c),this.scaling.pruneFeature(a,d,c),this.color.pruneFeature(a,d,c),this.opacity.pruneFeature(a,d,c),this.quaternion.pruneFeature(a,d,c),this.harmonics?this.harmonics.map(b=>b.pruneFeature(a,d,this.variableChunkSize)):void 0,c)}static async loadConfig(a){return await (await fetch(a,{method:"GET",mode:"cors",headers:{Accept:"application/json"}})).json()}toGaussians(){let a={},b=0;if(a.x={dtype:"float",index:0},a.y={dtype:"float",index:++b},a.z={dtype:"float",index:++b},a.f_dc_0={dtype:"float",index:++b},a.f_dc_1={dtype:"float",index:++b},a.f_dc_2={dtype:"float",index:++b},b++,this.harmonics&&this.harmonics.length>0)for(let c=0;c<this.harmonics.length;c++)a[`f_rest_${c}`]={dtype:"float",index:b},b++,a[`f_rest_${c+1}`]={dtype:"float",index:b},b++,a[`f_rest_${c+2}`]={dtype:"float",index:b},b++;a.opacity={dtype:"float",index:b},a.scale_0={dtype:"float",index:++b},a.scale_1={dtype:"float",index:++b},a.scale_2={dtype:"float",index:++b},a.rot_0={dtype:"float",index:++b},a.rot_1={dtype:"float",index:++b},a.rot_2={dtype:"float",index:++b},a.rot_3={dtype:"float",index:++b},b++;let c=this.harmonics?.map(a=>a.denormDequant());return new Q(a,{format:"binary_little_endian",version:"1.0"},this.xyz.length,this.xyz.denormDequant(),this.color.denormDequant(),c||[],this.opacity.denormDequant(),this.scaling.denormDequant(),this.quaternion.denormDequant(),3)}},S=l(p(),1),T=l(u(),1),U="u">typeof Float32Array?Float32Array:Array,V=Math.random;Math.hypot||(Math.hypot=function(){for(var a=0,b=arguments.length;b--;)a+=arguments[b]*arguments[b];return Math.sqrt(a)});var W={};function X(){var a=new U(9);return U!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function Y(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[4],a[4]=b[5],a[5]=b[6],a[6]=b[8],a[7]=b[9],a[8]=b[10],a}function Z(a){var b=new U(9);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b}function $(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a}function _(a,b,c,d,e,f,g,h,i){var j=new U(9);return j[0]=a,j[1]=b,j[2]=c,j[3]=d,j[4]=e,j[5]=f,j[6]=g,j[7]=h,j[8]=i,j}function aa(a,b,c,d,e,f,g,h,i,j){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a[6]=h,a[7]=i,a[8]=j,a}function ab(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a}function ac(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3],a[2]=b[6],a[3]=c,a[5]=b[7],a[6]=d,a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a}function ad(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null}function ae(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8];return a[0]=g*k-h*j,a[1]=e*j-d*k,a[2]=d*h-e*g,a[3]=h*i-f*k,a[4]=c*k-e*i,a[5]=e*f-c*h,a[6]=f*j-g*i,a[7]=d*i-c*j,a[8]=c*g-d*f,a}function af(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8];return b*(j*f-g*i)+c*(-j*e+g*h)+d*(i*e-f*h)}function ag(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a}function ah(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=m*d+n*g+j,a[7]=m*e+n*h+k,a[8]=m*f+n*i+l,a}function ai(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=Math.sin(c),n=Math.cos(c);return a[0]=n*d+m*g,a[1]=n*e+m*h,a[2]=n*f+m*i,a[3]=n*g-m*d,a[4]=n*h-m*e,a[5]=n*i-m*f,a[6]=j,a[7]=k,a[8]=l,a}function aj(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a}function ak(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=b[0],a[7]=b[1],a[8]=1,a}function al(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=-c,a[4]=d,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a}function am(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=b[1],a[5]=0,a[6]=0,a[7]=0,a[8]=1,a}function an(a,b){return a[0]=b[0],a[1]=b[1],a[2]=0,a[3]=b[2],a[4]=b[3],a[5]=0,a[6]=b[4],a[7]=b[5],a[8]=1,a}function ao(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[3]=k-r,a[6]=m+q,a[1]=k+r,a[4]=1-j-o,a[7]=n-p,a[2]=m-q,a[5]=n+p,a[8]=1-j-l,a}function ap(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(i*A-g*D-j*z)*E,a[2]=(g*C-h*A+j*y)*E,a[3]=(e*C-d*D-f*B)*E,a[4]=(c*D-e*A+f*z)*E,a[5]=(d*A-c*C-f*y)*E,a[6]=(p*x-q*w+r*v)*E,a[7]=(q*u-o*x-r*t)*E,a[8]=(o*w-p*u+r*s)*E,a):null}function aq(a,b,c){return a[0]=2/b,a[1]=0,a[2]=0,a[3]=0,a[4]=-2/c,a[5]=0,a[6]=-1,a[7]=1,a[8]=1,a}function ar(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"}function as(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}function at(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a}function au(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a}function av(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a}function aw(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a}function ax(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]}function ay(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=b[0],m=b[1],n=b[2],o=b[3],p=b[4],q=b[5],r=b[6],s=b[7],t=b[8];return Math.abs(c-l)<=1e-6*Math.max(1,Math.abs(c),Math.abs(l))&&Math.abs(d-m)<=1e-6*Math.max(1,Math.abs(d),Math.abs(m))&&Math.abs(e-n)<=1e-6*Math.max(1,Math.abs(e),Math.abs(n))&&Math.abs(f-o)<=1e-6*Math.max(1,Math.abs(f),Math.abs(o))&&Math.abs(g-p)<=1e-6*Math.max(1,Math.abs(g),Math.abs(p))&&Math.abs(h-q)<=1e-6*Math.max(1,Math.abs(h),Math.abs(q))&&Math.abs(i-r)<=1e-6*Math.max(1,Math.abs(i),Math.abs(r))&&Math.abs(j-s)<=1e-6*Math.max(1,Math.abs(j),Math.abs(s))&&Math.abs(k-t)<=1e-6*Math.max(1,Math.abs(k),Math.abs(t))}k(W,{add:()=>at,adjoint:()=>ae,clone:()=>Z,copy:()=>$,create:()=>X,determinant:()=>af,equals:()=>ay,exactEquals:()=>ax,frob:()=>as,fromMat2d:()=>an,fromMat4:()=>Y,fromQuat:()=>ao,fromRotation:()=>al,fromScaling:()=>am,fromTranslation:()=>ak,fromValues:()=>_,identity:()=>ab,invert:()=>ad,mul:()=>az,multiply:()=>ag,multiplyScalar:()=>av,multiplyScalarAndAdd:()=>aw,normalFromMat4:()=>ap,projection:()=>aq,rotate:()=>ai,scale:()=>aj,set:()=>aa,str:()=>ar,sub:()=>aA,subtract:()=>au,translate:()=>ah,transpose:()=>ac});var az=ag,aA=au,aB={};function aC(){var a=new U(16);return U!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function aD(a){var b=new U(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b}function aE(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a}function aF(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=new U(16);return q[0]=a,q[1]=b,q[2]=c,q[3]=d,q[4]=e,q[5]=f,q[6]=g,q[7]=h,q[8]=i,q[9]=j,q[10]=k,q[11]=l,q[12]=m,q[13]=n,q[14]=o,q[15]=p,q}function aG(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a[6]=h,a[7]=i,a[8]=j,a[9]=k,a[10]=l,a[11]=m,a[12]=n,a[13]=o,a[14]=p,a[15]=q,a}function aH(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function aI(a,b){if(a===b){var c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a}function aJ(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,a[0]=(h*D-i*C+j*B)*E,a[1]=(e*C-d*D-f*B)*E,a[2]=(p*x-q*w+r*v)*E,a[3]=(m*w-l*x-n*v)*E,a[4]=(i*A-g*D-j*z)*E,a[5]=(c*D-e*A+f*z)*E,a[6]=(q*u-o*x-r*t)*E,a[7]=(k*x-m*u+n*t)*E,a[8]=(g*C-h*A+j*y)*E,a[9]=(d*A-c*C-f*y)*E,a[10]=(o*w-p*u+r*s)*E,a[11]=(l*u-k*w-n*s)*E,a[12]=(h*z-g*B-i*y)*E,a[13]=(c*B-d*z+e*y)*E,a[14]=(p*t-o*v-q*s)*E,a[15]=(k*v-l*t+m*s)*E,a):null}function aK(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],m=b[10],n=b[11],o=b[12],p=b[13],q=b[14],r=b[15];return a[0]=h*(m*r-n*q)-l*(i*r-j*q)+p*(i*n-j*m),a[1]=-(d*(m*r-n*q)-l*(e*r-f*q)+p*(e*n-f*m)),a[2]=d*(i*r-j*q)-h*(e*r-f*q)+p*(e*j-f*i),a[3]=-(d*(i*n-j*m)-h*(e*n-f*m)+l*(e*j-f*i)),a[4]=-(g*(m*r-n*q)-k*(i*r-j*q)+o*(i*n-j*m)),a[5]=c*(m*r-n*q)-k*(e*r-f*q)+o*(e*n-f*m),a[6]=-(c*(i*r-j*q)-g*(e*r-f*q)+o*(e*j-f*i)),a[7]=c*(i*n-j*m)-g*(e*n-f*m)+k*(e*j-f*i),a[8]=g*(l*r-n*p)-k*(h*r-j*p)+o*(h*n-j*l),a[9]=-(c*(l*r-n*p)-k*(d*r-f*p)+o*(d*n-f*l)),a[10]=c*(h*r-j*p)-g*(d*r-f*p)+o*(d*j-f*h),a[11]=-(c*(h*n-j*l)-g*(d*n-f*l)+k*(d*j-f*h)),a[12]=-(g*(l*q-m*p)-k*(h*q-i*p)+o*(h*m-i*l)),a[13]=c*(l*q-m*p)-k*(d*q-e*p)+o*(d*m-e*l),a[14]=-(c*(h*q-i*p)-g*(d*q-e*p)+o*(d*i-e*h)),a[15]=c*(h*m-i*l)-g*(d*m-e*l)+k*(d*i-e*h),a}function aL(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],m=a[11],n=a[12],o=a[13],p=a[14],q=a[15];return(b*g-c*f)*(l*q-m*p)-(b*h-d*f)*(k*q-m*o)+(b*i-e*f)*(k*p-l*o)+(c*h-d*g)*(j*q-m*n)-(c*i-e*g)*(j*p-l*n)+(d*i-e*h)*(j*o-k*n)}function aM(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c[0],u=c[1],v=c[2],w=c[3];return a[0]=t*d+u*h+v*l+w*p,a[1]=t*e+u*i+v*m+w*q,a[2]=t*f+u*j+v*n+w*r,a[3]=t*g+u*k+v*o+w*s,t=c[4],u=c[5],v=c[6],w=c[7],a[4]=t*d+u*h+v*l+w*p,a[5]=t*e+u*i+v*m+w*q,a[6]=t*f+u*j+v*n+w*r,a[7]=t*g+u*k+v*o+w*s,t=c[8],u=c[9],v=c[10],w=c[11],a[8]=t*d+u*h+v*l+w*p,a[9]=t*e+u*i+v*m+w*q,a[10]=t*f+u*j+v*n+w*r,a[11]=t*g+u*k+v*o+w*s,t=c[12],u=c[13],v=c[14],w=c[15],a[12]=t*d+u*h+v*l+w*p,a[13]=t*e+u*i+v*m+w*q,a[14]=t*f+u*j+v*n+w*r,a[15]=t*g+u*k+v*o+w*s,a}function aN(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p=c[0],q=c[1],r=c[2];return b===a?(a[12]=b[0]*p+b[4]*q+b[8]*r+b[12],a[13]=b[1]*p+b[5]*q+b[9]*r+b[13],a[14]=b[2]*p+b[6]*q+b[10]*r+b[14],a[15]=b[3]*p+b[7]*q+b[11]*r+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=b[9],n=b[10],o=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=m,a[10]=n,a[11]=o,a[12]=d*p+h*q+l*r+b[12],a[13]=e*p+i*q+m*r+b[13],a[14]=f*p+j*q+n*r+b[14],a[15]=g*p+k*q+o*r+b[15]),a}function aO(a,b,c){var d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a}function aP(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=d[0],D=d[1],E=d[2],F=Math.hypot(C,D,E);return F<1e-6?null:(C*=F=1/F,D*=F,E*=F,e=Math.sin(c),g=1-(f=Math.cos(c)),h=b[0],i=b[1],j=b[2],k=b[3],l=b[4],m=b[5],n=b[6],o=b[7],p=b[8],q=b[9],r=b[10],s=b[11],t=C*C*g+f,u=D*C*g+E*e,v=E*C*g-D*e,w=C*D*g-E*e,x=D*D*g+f,y=E*D*g+C*e,z=C*E*g+D*e,A=D*E*g-C*e,B=E*E*g+f,a[0]=h*t+l*u+p*v,a[1]=i*t+m*u+q*v,a[2]=j*t+n*u+r*v,a[3]=k*t+o*u+s*v,a[4]=h*w+l*x+p*y,a[5]=i*w+m*x+q*y,a[6]=j*w+n*x+r*y,a[7]=k*w+o*x+s*y,a[8]=h*z+l*A+p*B,a[9]=i*z+m*A+q*B,a[10]=j*z+n*A+r*B,a[11]=k*z+o*A+s*B,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)}function aQ(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+m*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=m*e-i*d,a}function aR(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],m=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-m*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+m*e,a}function aS(a,b,c){var d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],m=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+m*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=m*e-i*d,a}function aT(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a}function aU(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=b[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function aV(a,b,c){var d,e,f,g=c[0],h=c[1],i=c[2],j=Math.hypot(g,h,i);return j<1e-6?null:(g*=j=1/j,h*=j,i*=j,d=Math.sin(b),f=1-(e=Math.cos(b)),a[0]=g*g*f+e,a[1]=h*g*f+i*d,a[2]=i*g*f-h*d,a[3]=0,a[4]=g*h*f-i*d,a[5]=h*h*f+e,a[6]=i*h*f+g*d,a[7]=0,a[8]=g*i*f+h*d,a[9]=h*i*f-g*d,a[10]=i*i*f+e,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function aW(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=c,a[7]=0,a[8]=0,a[9]=-c,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function aX(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=0,a[2]=-c,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=c,a[9]=0,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function aY(a,b){var c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=0,a[4]=-c,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function aZ(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,m=d*j,n=e*i,o=e*j,p=f*j,q=g*h,r=g*i,s=g*j;return a[0]=1-(n+p),a[1]=l+s,a[2]=m-r,a[3]=0,a[4]=l-s,a[5]=1-(k+p),a[6]=o+q,a[7]=0,a[8]=m+r,a[9]=o-q,a[10]=1-(k+n),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a}function a$(a,b){var c=new U(3),d=-b[0],e=-b[1],f=-b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=d*d+e*e+f*f+g*g;return l>0?(c[0]=(h*g+k*d+i*f-j*e)*2/l,c[1]=(i*g+k*e+j*d-h*f)*2/l,c[2]=(j*g+k*f+h*e-i*d)*2/l):(c[0]=(h*g+k*d+i*f-j*e)*2,c[1]=(i*g+k*e+j*d-h*f)*2,c[2]=(j*g+k*f+h*e-i*d)*2),aZ(a,b,c),a}function a_(a,b){return a[0]=b[12],a[1]=b[13],a[2]=b[14],a}function a0(a,b){var c=b[0],d=b[1],e=b[2],f=b[4],g=b[5],h=b[6],i=b[8],j=b[9],k=b[10];return a[0]=Math.hypot(c,d,e),a[1]=Math.hypot(f,g,h),a[2]=Math.hypot(i,j,k),a}function a1(a,b){var c=new U(3);a0(c,b);var d=1/c[0],e=1/c[1],f=1/c[2],g=b[0]*d,h=b[1]*e,i=b[2]*f,j=b[4]*d,k=b[5]*e,l=b[6]*f,m=b[8]*d,n=b[9]*e,o=b[10]*f,p=g+k+o,q=0;return p>0?(q=2*Math.sqrt(p+1),a[3]=.25*q,a[0]=(l-n)/q,a[1]=(m-i)/q,a[2]=(h-j)/q):g>k&&g>o?(q=2*Math.sqrt(1+g-k-o),a[3]=(l-n)/q,a[0]=.25*q,a[1]=(h+j)/q,a[2]=(m+i)/q):k>o?(q=2*Math.sqrt(1+k-g-o),a[3]=(m-i)/q,a[0]=(h+j)/q,a[1]=.25*q,a[2]=(l+n)/q):(q=2*Math.sqrt(1+o-g-k),a[3]=(h-j)/q,a[0]=(m+i)/q,a[1]=(l+n)/q,a[2]=.25*q),a}function a2(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3],i=e+e,j=f+f,k=g+g,l=e*i,m=e*j,n=e*k,o=f*j,p=f*k,q=g*k,r=h*i,s=h*j,t=h*k,u=d[0],v=d[1],w=d[2];return a[0]=(1-(o+q))*u,a[1]=(m+t)*u,a[2]=(n-s)*u,a[3]=0,a[4]=(m-t)*v,a[5]=(1-(l+q))*v,a[6]=(p+r)*v,a[7]=0,a[8]=(n+s)*w,a[9]=(p-r)*w,a[10]=(1-(l+o))*w,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a}function a3(a,b,c,d,e){var f=b[0],g=b[1],h=b[2],i=b[3],j=f+f,k=g+g,l=h+h,m=f*j,n=f*k,o=f*l,p=g*k,q=g*l,r=h*l,s=i*j,t=i*k,u=i*l,v=d[0],w=d[1],x=d[2],y=e[0],z=e[1],A=e[2],B=(1-(p+r))*v,C=(n+u)*v,D=(o-t)*v,E=(n-u)*w,F=(1-(m+r))*w,G=(q+s)*w,H=(o+t)*x,I=(q-s)*x,J=(1-(m+p))*x;return a[0]=B,a[1]=C,a[2]=D,a[3]=0,a[4]=E,a[5]=F,a[6]=G,a[7]=0,a[8]=H,a[9]=I,a[10]=J,a[11]=0,a[12]=c[0]+y-(B*y+E*z+H*A),a[13]=c[1]+z-(C*y+F*z+I*A),a[14]=c[2]+A-(D*y+G*z+J*A),a[15]=1,a}function a4(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,m=e*g,n=e*h,o=e*i,p=f*g,q=f*h,r=f*i;return a[0]=1-l-o,a[1]=k+r,a[2]=m-q,a[3]=0,a[4]=k-r,a[5]=1-j-o,a[6]=n+p,a[7]=0,a[8]=m+q,a[9]=n-p,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function a5(a,b,c,d,e,f,g){var h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a}function a6(a,b,c,d,e){var f,g=1/Math.tan(b/2);return a[0]=g/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=e&&e!==1/0?(f=1/(d-e),a[10]=(e+d)*f,a[14]=2*e*d*f):(a[10]=-1,a[14]=-2*d),a}k(aB,{add:()=>bh,adjoint:()=>aK,clone:()=>aD,copy:()=>aE,create:()=>aC,determinant:()=>aL,equals:()=>bm,exactEquals:()=>bl,frob:()=>bg,fromQuat:()=>a4,fromQuat2:()=>a$,fromRotation:()=>aV,fromRotationTranslation:()=>aZ,fromRotationTranslationScale:()=>a2,fromRotationTranslationScaleOrigin:()=>a3,fromScaling:()=>aU,fromTranslation:()=>aT,fromValues:()=>aF,fromXRotation:()=>aW,fromYRotation:()=>aX,fromZRotation:()=>aY,frustum:()=>a5,getRotation:()=>a1,getScaling:()=>a0,getTranslation:()=>a_,identity:()=>aH,invert:()=>aJ,lookAt:()=>bd,mul:()=>bn,multiply:()=>aM,multiplyScalar:()=>bj,multiplyScalarAndAdd:()=>bk,ortho:()=>bb,orthoNO:()=>ba,orthoZO:()=>bc,perspective:()=>a7,perspectiveFromFieldOfView:()=>a9,perspectiveNO:()=>a6,perspectiveZO:()=>a8,rotate:()=>aP,rotateX:()=>aQ,rotateY:()=>aR,rotateZ:()=>aS,scale:()=>aO,set:()=>aG,str:()=>bf,sub:()=>bo,subtract:()=>bi,targetTo:()=>be,translate:()=>aN,transpose:()=>aI});var a7=a6;function a8(a,b,c,d,e){var f,g=1/Math.tan(b/2);return a[0]=g/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=g,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=e&&e!==1/0?(f=1/(d-e),a[10]=e*f,a[14]=e*d*f):(a[10]=-1,a[14]=-d),a}function a9(a,b,c,d){var e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180),h=Math.tan(b.rightDegrees*Math.PI/180),i=2/(g+h),j=2/(e+f);return a[0]=i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=j,a[6]=0,a[7]=0,a[8]=-((g-h)*i*.5),a[9]=(e-f)*j*.5,a[10]=d/(c-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*c/(c-d),a[15]=0,a}function ba(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a}var bb=ba;function bc(a,b,c,d,e,f,g){var h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=f*j,a[15]=1,a}function bd(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o=b[0],p=b[1],q=b[2],r=d[0],s=d[1],t=d[2],u=c[0],v=c[1],w=c[2];return 1e-6>Math.abs(o-u)&&1e-6>Math.abs(p-v)&&1e-6>Math.abs(q-w)?aH(a):(n=1/Math.hypot(k=o-u,l=p-v,m=q-w),k*=n,l*=n,m*=n,(n=Math.hypot(e=s*m-t*l,f=t*k-r*m,g=r*l-s*k))?(e*=n=1/n,f*=n,g*=n):(e=0,f=0,g=0),(n=Math.hypot(h=l*g-m*f,i=m*e-k*g,j=k*f-l*e))?(h*=n=1/n,i*=n,j*=n):(h=0,i=0,j=0),a[0]=e,a[1]=h,a[2]=k,a[3]=0,a[4]=f,a[5]=i,a[6]=l,a[7]=0,a[8]=g,a[9]=j,a[10]=m,a[11]=0,a[12]=-(e*o+f*p+g*q),a[13]=-(h*o+i*p+j*q),a[14]=-(k*o+l*p+m*q),a[15]=1,a)}function be(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=d[0],i=d[1],j=d[2],k=e-c[0],l=f-c[1],m=g-c[2],n=k*k+l*l+m*m;n>0&&(k*=n=1/Math.sqrt(n),l*=n,m*=n);var o=i*m-j*l,p=j*k-h*m,q=h*l-i*k;return(n=o*o+p*p+q*q)>0&&(o*=n=1/Math.sqrt(n),p*=n,q*=n),a[0]=o,a[1]=p,a[2]=q,a[3]=0,a[4]=l*q-m*p,a[5]=m*o-k*q,a[6]=k*p-l*o,a[7]=0,a[8]=k,a[9]=l,a[10]=m,a[11]=0,a[12]=e,a[13]=f,a[14]=g,a[15]=1,a}function bf(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"}function bg(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15])}function bh(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a[9]=b[9]+c[9],a[10]=b[10]+c[10],a[11]=b[11]+c[11],a[12]=b[12]+c[12],a[13]=b[13]+c[13],a[14]=b[14]+c[14],a[15]=b[15]+c[15],a}function bi(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a[9]=b[9]-c[9],a[10]=b[10]-c[10],a[11]=b[11]-c[11],a[12]=b[12]-c[12],a[13]=b[13]-c[13],a[14]=b[14]-c[14],a[15]=b[15]-c[15],a}function bj(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a[9]=b[9]*c,a[10]=b[10]*c,a[11]=b[11]*c,a[12]=b[12]*c,a[13]=b[13]*c,a[14]=b[14]*c,a[15]=b[15]*c,a}function bk(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a[9]=b[9]+c[9]*d,a[10]=b[10]+c[10]*d,a[11]=b[11]+c[11]*d,a[12]=b[12]+c[12]*d,a[13]=b[13]+c[13]*d,a[14]=b[14]+c[14]*d,a[15]=b[15]+c[15]*d,a}function bl(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]}function bm(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],m=a[10],n=a[11],o=a[12],p=a[13],q=a[14],r=a[15],s=b[0],t=b[1],u=b[2],v=b[3],w=b[4],x=b[5],y=b[6],z=b[7],A=b[8],B=b[9],C=b[10],D=b[11],E=b[12],F=b[13],G=b[14],H=b[15];return Math.abs(c-s)<=1e-6*Math.max(1,Math.abs(c),Math.abs(s))&&Math.abs(d-t)<=1e-6*Math.max(1,Math.abs(d),Math.abs(t))&&Math.abs(e-u)<=1e-6*Math.max(1,Math.abs(e),Math.abs(u))&&Math.abs(f-v)<=1e-6*Math.max(1,Math.abs(f),Math.abs(v))&&Math.abs(g-w)<=1e-6*Math.max(1,Math.abs(g),Math.abs(w))&&Math.abs(h-x)<=1e-6*Math.max(1,Math.abs(h),Math.abs(x))&&Math.abs(i-y)<=1e-6*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(j-z)<=1e-6*Math.max(1,Math.abs(j),Math.abs(z))&&Math.abs(k-A)<=1e-6*Math.max(1,Math.abs(k),Math.abs(A))&&Math.abs(l-B)<=1e-6*Math.max(1,Math.abs(l),Math.abs(B))&&Math.abs(m-C)<=1e-6*Math.max(1,Math.abs(m),Math.abs(C))&&Math.abs(n-D)<=1e-6*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(o-E)<=1e-6*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(p-F)<=1e-6*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(q-G)<=1e-6*Math.max(1,Math.abs(q),Math.abs(G))&&Math.abs(r-H)<=1e-6*Math.max(1,Math.abs(r),Math.abs(H))}var bn=aM,bo=bi,bp={};function bq(){var a=new U(3);return U!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function br(a,b,c){var d=new U(3);return d[0]=a,d[1]=b,d[2]=c,d}function bs(a,b,c){var d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a}function bt(){var a=new U(4);return U!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function bu(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function bv(a,b,c){var d=Math.sin(c*=.5);return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=Math.cos(c),a}function bw(a,b){var c=2*Math.acos(b[3]),d=Math.sin(c/2);return d>1e-6?(a[0]=b[0]/d,a[1]=b[1]/d,a[2]=b[2]/d):(a[0]=1,a[1]=0,a[2]=0),c}function bx(a,b){var c=bU(a,b);return Math.acos(2*c*c-1)}function by(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=c[0],i=c[1],j=c[2],k=c[3];return a[0]=d*k+g*h+e*j-f*i,a[1]=e*k+g*i+f*h-d*j,a[2]=f*k+g*j+d*i-e*h,a[3]=g*k-d*h-e*i-f*j,a}function bz(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+g*h,a[1]=e*i+f*h,a[2]=f*i-e*h,a[3]=g*i-d*h,a}function bA(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i-f*h,a[1]=e*i+g*h,a[2]=f*i+d*h,a[3]=g*i-e*h,a}function bB(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2],g=b[3],h=Math.sin(c),i=Math.cos(c);return a[0]=d*i+e*h,a[1]=e*i-d*h,a[2]=f*i+g*h,a[3]=g*i-f*h,a}function bC(a,b){var c=b[0],d=b[1],e=b[2];return a[0]=c,a[1]=d,a[2]=e,a[3]=Math.sqrt(Math.abs(1-c*c-d*d-e*e)),a}function bD(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=Math.sqrt(c*c+d*d+e*e),h=Math.exp(f),i=g>0?h*Math.sin(g)/g:0;return a[0]=c*i,a[1]=d*i,a[2]=e*i,a[3]=h*Math.cos(g),a}function bE(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=Math.sqrt(c*c+d*d+e*e),h=g>0?Math.atan2(g,f)/g:0;return a[0]=c*h,a[1]=d*h,a[2]=e*h,a[3]=.5*Math.log(c*c+d*d+e*e+f*f),a}function bF(a,b,c){return bE(a,b),bT(a,a,c),bD(a,a),a}function bG(a,b,c,d){var e,f,g,h,i,j=b[0],k=b[1],l=b[2],m=b[3],n=c[0],o=c[1],p=c[2],q=c[3];return(f=j*n+k*o+l*p+m*q)<0&&(f=-f,n=-n,o=-o,p=-p,q=-q),1-f>1e-6?(g=Math.sin(e=Math.acos(f)),h=Math.sin((1-d)*e)/g,i=Math.sin(d*e)/g):(h=1-d,i=d),a[0]=h*j+i*n,a[1]=h*k+i*o,a[2]=h*l+i*p,a[3]=h*m+i*q,a}function bH(a){var b=V(),c=V(),d=V(),e=Math.sqrt(1-b),f=Math.sqrt(b);return a[0]=e*Math.sin(2*Math.PI*c),a[1]=e*Math.cos(2*Math.PI*c),a[2]=f*Math.sin(2*Math.PI*d),a[3]=f*Math.cos(2*Math.PI*d),a}function bI(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f,h=g?1/g:0;return a[0]=-c*h,a[1]=-d*h,a[2]=-e*h,a[3]=f*h,a}function bJ(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=b[3],a}function bK(a,b){var c,d=b[0]+b[4]+b[8];if(d>0)c=Math.sqrt(d+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var e=0;b[4]>b[0]&&(e=1),b[8]>b[3*e+e]&&(e=2);var f=(e+1)%3,g=(e+2)%3;c=Math.sqrt(b[3*e+e]-b[3*f+f]-b[3*g+g]+1),a[e]=.5*c,c=.5/c,a[3]=(b[3*f+g]-b[3*g+f])*c,a[f]=(b[3*f+e]+b[3*e+f])*c,a[g]=(b[3*g+e]+b[3*e+g])*c}return a}function bL(a,b,c,d){var e=.5*Math.PI/180;b*=e,c*=e,d*=e;var f=Math.sin(b),g=Math.cos(b),h=Math.sin(c),i=Math.cos(c),j=Math.sin(d),k=Math.cos(d);return a[0]=f*i*k-g*h*j,a[1]=g*h*k+f*i*j,a[2]=g*i*j-f*h*k,a[3]=g*i*k+f*h*j,a}function bM(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"}k(bp,{add:()=>bR,calculateW:()=>bC,clone:()=>bN,conjugate:()=>bJ,copy:()=>bP,create:()=>bt,dot:()=>bU,equals:()=>b0,exactEquals:()=>b_,exp:()=>bD,fromEuler:()=>bL,fromMat3:()=>bK,fromValues:()=>bO,getAngle:()=>bx,getAxisAngle:()=>bw,identity:()=>bu,invert:()=>bI,len:()=>bX,length:()=>bW,lerp:()=>bV,ln:()=>bE,mul:()=>bS,multiply:()=>by,normalize:()=>b$,pow:()=>bF,random:()=>bH,rotateX:()=>bz,rotateY:()=>bA,rotateZ:()=>bB,rotationTo:()=>b1,scale:()=>bT,set:()=>bQ,setAxes:()=>b3,setAxisAngle:()=>bv,slerp:()=>bG,sqlerp:()=>b2,sqrLen:()=>bZ,squaredLength:()=>bY,str:()=>bM}),bq(),!function(){var a;a=new U(4),U!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0)}();var bN=function(a){var b=new U(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b},bO=function(a,b,c,d){var e=new U(4);return e[0]=a,e[1]=b,e[2]=c,e[3]=d,e},bP=function(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a},bQ=function(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a},bR=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a},bS=by,bT=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a},bU=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},bV=function(a,b,c,d){var e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a},bW=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},bX=bW,bY=function(a){var b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e},bZ=bY,b$=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g)),a[0]=c*g,a[1]=d*g,a[2]=e*g,a[3]=f*g,a},b_=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},b0=function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=b[0],h=b[1],i=b[2],j=b[3];return Math.abs(c-g)<=1e-6*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(d-h)<=1e-6*Math.max(1,Math.abs(d),Math.abs(h))&&Math.abs(e-i)<=1e-6*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(f-j)<=1e-6*Math.max(1,Math.abs(f),Math.abs(j))},b1=function(){var a=bq(),b=br(1,0,0),c=br(0,1,0);return function(d,e,f){var g,h,i,j,k=e[0]*f[0]+e[1]*f[1]+e[2]*f[2];return k<-.999999?(bs(a,b,e),1e-6>Math.hypot(a[0],a[1],a[2])&&bs(a,c,e),(j=(g=a[0])*g+(h=a[1])*h+(i=a[2])*i)>0&&(j=1/Math.sqrt(j)),a[0]=a[0]*j,a[1]=a[1]*j,a[2]=a[2]*j,bv(d,a,Math.PI),d):k>.999999?(d[0]=0,d[1]=0,d[2]=0,d[3]=1,d):(bs(a,e,f),d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=1+k,b$(d,d))}}(),b2=function(){var a=bt(),b=bt();return function(c,d,e,f,g,h){return bG(a,d,g,h),bG(b,e,f,h),bG(c,a,b,2*h*(1-h)),c}}(),b3=function(){var a=X();return function(b,c,d,e){return a[0]=d[0],a[3]=d[1],a[6]=d[2],a[1]=e[0],a[4]=e[1],a[7]=e[2],a[2]=-c[0],a[5]=-c[1],a[8]=-c[2],b$(b,bK(b,a))}}(),b4={xyz:3,color:3,opacity:1,scaling:3,quaternion:4,harmonics:3},b5=class{constructor(a){this.version="",this._buffer=a}get buffer(){return this._buffer}get decoded(){return this._decoded||(this._decoded=this.decodeBuffer()),this._decoded}get colorsA(){let a=this.decoded.color.denormDequant(),b=this.decoded.opacity.denormDequant(),c=(0,S.default)(new Float32Array(4*a.shape[0]),[a.shape[0],4]);return T.mulseq(a,.28209479177387814),T.addseq(a,.5),T.mulseq(a,255),T.maxseq(a,0),T.minseq(a,255),""===this.version&&(T.negeq(b),T.expeq(b),T.addseq(b,1),T.recipeq(b),T.mulseq(b,255)),T.assign(c.hi(a.shape[0],3).lo(0,0),a),T.assign(c.hi(a.shape[0],4).lo(0,3),b),(0,S.default)(new Uint8Array(c.data),[a.shape[0],4]).data}get nsplats(){return this.decoded.nsplats}getSplatCount(){return this.decoded.nsplats}get precomputedCovarianceBufferData(){return this._precomputedCovarianceBufferData}decodeBuffer(){let{splatCount:a,chunkCount:b,chunkSize:c,typeChunks:d,vertexData:e,propertiesDesc:f,version:g}=this.decodeHeader();this.version=g;let h={xyz:f.xyz.compressionMethod,color:f.color.compressionMethod,opacity:f.opacity.compressionMethod,scaling:f.scaling.compressionMethod,quaternion:f.quaternion.compressionMethod,chunkSize:c};f.harmonics_0&&(h.harmonics=f.harmonics_0.compressionMethod);let i=e.byteOffset,j=Array(Object.keys(f).length);for(let a in f)j[f[a].index]={name:a,method:f[a].compressionMethod};let k=2*b*4,l=i,m="dynamic"===d?2*b:0,n,o=!1;if(m>0){let a=new Uint16Array(e.buffer.slice(l,l+m));l+=m,n=Array.from(a),o=!0}let p={};for(let d of j){let f,g,h=0,i=!0;if("norm8x"===d.method)h=a*b4[d.name];else if("norm11"===d.method)h=4*a;else if("norm565"===d.method)h=2*a;else throw i=!1,Error(`Not Implemented format: ${d.method}`);if(i){let a=e.buffer.slice(l,l+k);f=(0,S.default)(new Float32Array(a),[b,2]),l+=k}else throw Error("loading chunk byt hasnot minmax!");let j=e.buffer.slice(l,l+h);if(l+=h,"norm8x"===d.method)g=(0,S.default)(new Uint8Array(j),[a,b4[d.name]]);else if("norm11"===d.method)g=(0,S.default)(new Uint32Array(j));else if("norm565"===d.method)g=(0,S.default)(new Uint16Array(j));else throw Error(`Not Implemented format: ${d.method}`);p[d.name]=new B(g,f,c,d.method,n,o)}let q=[];for(let a=0;a<15;a++){let b=p[`harmonics_${a}`];b&&(q.push(b),delete p[`harmonics_${a}`])}return q.length>0&&(p.harmonics=q),new R(h,p.xyz,p.scaling,p.color,p.opacity,p.quaternion,p.harmonics,n)}buildPreComputedBuffers(){let a=this.decoded,b=a.nsplats,c=new ArrayBuffer(24*b),d=new Float32Array(c),e=a.scaling.denormDequant(),f=a.quaternion.denormDequant(),g=bp.create(),h=W.create(),i=W.create(),j=W.create(),k=aB.create();for(let a=0;a<b;a++)aB.fromScaling(k,[Math.exp(e.get(a,0)),Math.exp(e.get(a,1)),Math.exp(e.get(a,2))]),W.fromMat4(i,k),bp.set(g,f.get(a,0),f.get(a,1),f.get(a,2),f.get(a,3)),W.fromQuat(h,g),W.multiply(j,h,i),d[6*a]=j[0]*j[0]+j[3]*j[3]+j[6]*j[6],d[6*a+1]=j[0]*j[1]+j[3]*j[4]+j[6]*j[7],d[6*a+2]=j[0]*j[2]+j[3]*j[5]+j[6]*j[8],d[6*a+3]=j[1]*j[1]+j[4]*j[4]+j[7]*j[7],d[6*a+4]=j[1]*j[2]+j[4]*j[5]+j[7]*j[8],d[6*a+5]=j[2]*j[2]+j[5]*j[5]+j[8]*j[8];this._precomputedCovarianceBufferData=c}decodeHeader(){let a=this._buffer,b=new TextDecoder,c=0,d="";for(;;){if(c+100>=a.byteLength)throw Error("End of file reached while searching for end of header");let e=new Uint8Array(a,c,100);d+=b.decode(e);let f=(c+=100)-200,g=new Uint8Array(a,Math.max(0,f),f>=0?200:100);if(b.decode(g).includes("end_header"))break}let e=d.split(`
`),f=0,g=0,h=0,i=0,j="",k="",l={};for(let a=0;a<e.length;a++){let b=e[a].trim();if(b.startsWith("version"))k=b.split(" ")[1]??"";else if(b.startsWith("element vertex")){let a=b.match(/\d+/);a&&(f=parseInt(a[0]))}else if(b.startsWith("property")){let a=b.match(/(\w+)\s+(\w+)\s+(\w+)/);if(a){let b=a[2],c=a[3];l[b]={compressionMethod:c,index:i},i++}}else if(b.startsWith("element chunks")){let a=b.match(/\d+/);a&&(g=parseInt(a[0]))}else if(b.startsWith("element chunkSize")){let a=b.match(/\d+/);a&&(h=parseInt(a[0]))}else if(b.startsWith("element typeChunks")){let a=b.match(/(\w+)\s+(\w+)\s+(\w+)/);a&&(j=a[3])}else if("end_header"===b)break}return{splatCount:f,chunkCount:g,chunkSize:h,typeChunks:j,vertexData:new DataView(a,d.indexOf("end_header")+10+1),propertiesDesc:l,version:k}}pruneSplats(a){let b=this.decodeBuffer().pruneSplats(a);return b5.fromCompressedGaussianSplats(b,this.version)}static fromCompressedGaussianSplats(a,b){let c=a.xyz.length,d=a.xyz.nchunks,e=`gspline
version ${b}
element vertex ${c}
element chunks ${d}
element chunkSize ${a.chunkSize}
element typeChunks ${a.isDynamicChunks?"dynamic":"static"}
property xyz ${a.xyz.method}
property color ${a.color.method}
property opacity ${a.opacity.method}
property scaling ${a.scaling.method}
property quaternion ${a.quaternion.method}`;if(a.harmonics&&a.harmonics.length>0)for(let b=0;b<a.harmonics.length;b++)e=`${e}
property harmonics_${b} ${a.harmonics[b].method}`;e=`${e}
end_header
`;let f=new TextEncoder().encode(e),g=2*d*4,h=a.xyz.quantized.data.buffer.byteLength,i=a.xyz instanceof B?g:0,j=a.color.quantized.data.buffer.byteLength,k=a.color instanceof B?g:0,l=a.opacity.quantized.data.buffer.byteLength,m=a.opacity instanceof B?g:0,n=a.scaling.quantized.data.buffer.byteLength,o=a.scaling instanceof B?g:0,p=a.quaternion.quantized.data.buffer.byteLength,q=a.quaternion instanceof B?g:0,r=a.variableChunkSize?Uint16Array.from(a.variableChunkSize):void 0,s=r?r.byteLength:0,t=f.byteLength+s+h+i+j+k+l+m+n+o+p+q,u=0,v=0;if(a.harmonics&&a.harmonics.length>0)for(let b=0;b<a.harmonics.length;b++)u+=a.harmonics[b].quantized.data.buffer.byteLength,a.harmonics[b]instanceof B;let w=new Uint8Array(t+=(u=0)+(v=0)),x=0;if(w.set(f,x),x+=f.byteLength,s>0&&(w.set(new Uint8Array(r.buffer),x),x+=s),a.xyz instanceof B&&(w.set(new Uint8Array(a.xyz.minmaxMatrix.data.buffer),x),x+=g),w.set(new Uint8Array(a.xyz.quantized.data.buffer),x),x+=h,a.color instanceof B&&(w.set(new Uint8Array(a.color.minmaxMatrix.data.buffer),x),x+=g),w.set(new Uint8Array(a.color.quantized.data.buffer),x),x+=j,a.opacity instanceof B&&(w.set(new Uint8Array(a.opacity.minmaxMatrix.data.buffer),x),x+=g),w.set(new Uint8Array(a.opacity.quantized.data.buffer),x),x+=l,a.scaling instanceof B&&(w.set(new Uint8Array(a.scaling.minmaxMatrix.data.buffer),x),x+=g),w.set(new Uint8Array(a.scaling.quantized.data.buffer),x),x+=n,a.quaternion instanceof B&&(w.set(new Uint8Array(a.quaternion.minmaxMatrix.data.buffer),x),x+=g),w.set(new Uint8Array(a.quaternion.quantized.data.buffer),x),x+=p,u>0&&a.harmonics&&a.harmonics.length>0)for(let b=0;b<a.harmonics.length;b++){let c=a.harmonics[b];c instanceof B&&(w.set(new Uint8Array(c.minmaxMatrix.data.buffer),x),x+=g),w.set(new Uint8Array(c.quantized.data.buffer),x),x+=c.quantized.data.byteLength}return new b5(w.buffer)}}}};